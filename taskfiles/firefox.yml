version: "3"

tasks:
  patch:
    dir: "{{ .FIREFOX_PROFILE }}"
    cmds:
      - test -n "{{ .FIREFOX_PROFILE }}"
      - test -d "{{ .FIREFOX_PROFILE }}"
      - "! pgrep -i firefox"
      - cp ~/.dotfiles/apps/firefox/arkenfox/{prefsCleaner.sh,updater.sh,user.js} .
      - ln -sf ~/.dotfiles/apps/firefox/user-overrides.js .
      - ./updater.sh -s
      - bash ./prefsCleaner.sh -s

  patch:windows:
    dir: C:\Users\adam\AppData\Roaming\Mozilla\Firefox\Profiles\kwocbecx.default-release
    cmds:
      - cp ~/.dotfiles/apps/firefox/arkenfox/{prefsCleaner.bat,updater.bat,user.js} .
      - cp ~/.dotfiles/apps/firefox/user-overrides.js .
      - .\\updater.bat -unattended
      - .\\prefsCleaner.bat

  update:
    cmds:
      - git subrepo pull --branch {{.VERSION}} firefox/arkenfox/
