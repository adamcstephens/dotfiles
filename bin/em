#!/usr/bin/env sh

if [ "$(uname -s)" = "Darwin" ]; then
  source /nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh
fi

if ! command -v emacsclient >/dev/null 2>&1; then
  echo "No emacsclient, falling back to vim"
  exec vim "$@"
fi

unset TMPDIR

if [ -z "$INSIDE_EMACS" ] && [ -n "$DISPLAY" ]; then
  args="--create-frame"

  if [ -z "$IS_EDITOR" ]; then
    args="$args --no-wait"
  fi
else
  if [ -z "$INSIDE_EMACS" ]; then
    args="--tty"
  elif [ -z "$IS_EDITOR" ]; then
    args="$args --no-wait"
  fi
fi

exec emacsclient $args "$@"
