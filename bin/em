#!/usr/bin/env sh

if [ "$(uname -s)" = "Darwin" ]; then
  source /nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh
fi

if ! command -v emacsclient >/dev/null 2>&1; then
  echo "No emacsclient, falling back to editor"
  exec ~/.dotfiles/bin/editor $@
fi

unset TMPDIR

if [ "$(uname -s)" = "Darwin" ]; then
  exec fish -l -c "~/.nix-profile/Applications/Emacs.app/Contents/MacOS/Emacs -init-directory ~/.config/emacs/dotemacs $@"
fi

if [ -n "$DISPLAY" ]; then
  args="--create-frame --no-wait"
else
  args="--tty"
fi

exec emacsclient $args "$@"
